!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("events"),require("alfrid"),require("shaders/test.vert")):"function"==typeof define&&define.amd?define(["events","alfrid","shaders/test.vert"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).WebGLAnimation=t(e.require$$0,e.alfrid,e.vs)}(this,(function(e,t,o){"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n=r(e),s=r(o);let i="123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ";window.fxhash="oo"+Array(49).fill(0).map((e=>i[Math.random()*i.length|0])).join("");let a=fxhash.slice(2),c=new RegExp(".{"+(fxhash.length/4|0)+"}","g"),l=a.match(c).map((e=>{return(t=e).split("").reduce(((e,o,r)=>e+i.indexOf(o)*Math.pow(i.length,t.length-r-1)),0);var t}));window.fxrand=((e,t,o,r)=>()=>{var n=((e|=0)+(t|=0)|0)+(r|=0)|0;return r=r+1|0,e=t^t>>>9,t=(o|=0)+(o<<3)|0,o=(o=o<<21|o>>>11)+n|0,(n>>>0)/4294967296})(...l);const u=[{id:"color",url:"assets/color.jpg",type:"jpg"},{id:"tree",url:"assets/tree.obj",type:"text"}];let d;const f=e=>{d=e.map((({id:e,file:o,type:r})=>{const n=o;let s;switch(r){case"jpg":case"png":s=new t.GLTexture(o);break;case"text":s=t.parseObj(o)}return{id:e,source:n,type:r,file:s}})),console.table(d)};var p=n.default.EventEmitter;function h(){p.call(this),this.setMaxListeners(20)}h.prototype=Object.create(p.prototype),h.prototype.constructor=h,h.prototype.off=function(e,t){return t?this.removeListener(e,t):e?this.removeAllListeners(e):this.removeAllListeners()};var g=h,m=function(){try{return!!new Blob}catch(e){return!1}}(),v={mbs:0,secs:0,update:function(e,t,o,r){var n,s=e.getAllResponseHeaders();if(s){var i=s.match(/content-length: (\d+)/i);i&&i.length&&(n=i[1])}if(n){var a=(n=parseInt(n,10))/1024/1024,c=(Date.now()-t)/1e3;this.secs+=c,this.mbs+=a,r&&this.log(o,a,c)}else r&&console.warn.call(console,"Can't get Content-Length:",o)},log:function(e,t,o){if(e){var r="File loaded: "+e.substr(e.lastIndexOf("/")+1)+" size:"+t.toFixed(2)+"mb time:"+o.toFixed(2)+"s speed:"+(t/o).toFixed(2)+"mbps";console.log.call(console,r)}var n="Total loaded: "+this.mbs.toFixed(2)+"mb time:"+this.secs.toFixed(2)+"s speed:"+this.getMbps().toFixed(2)+"mbps";console.log.call(console,n)},getMbps:function(){return this.mbs/this.secs}},b=g,w=m,y=v,L=g,x=function(e){var t,o,r,n,s,i,a=e.id,c=e.basePath||"",l=e.url,u=e.type,d=e.crossOrigin,f=e.isTouchLocked,p=e.blob&&w,h=e.webAudioContext,g=e.log,m=function(e){e&&(i={id:a,file:e,type:u},t.emit("progress",1),t.emit("complete",i,a,u),M())},v=function(e,t){o=t||x,(r=new XMLHttpRequest).open("GET",c+l,!0),r.responseType=e,r.addEventListener("progress",L),r.addEventListener("load",o),r.addEventListener("error",G),r.send()},L=function(e){e.lengthComputable&&t.emit("progress",e.loaded/e.total)},x=function(){E()&&m(r.response)},E=function(){return r&&r.status<400?(y.update(r,n,l,g),!0):(G(r&&r.statusText),!1)},_=function(){v("json",(function(){if(E()){var e=r.response;"string"==typeof e&&(e=JSON.parse(e)),m(e)}}))},A=function(){p?j():O()},O=function(){r=new Image,d&&(r.crossOrigin="anonymous"),r.addEventListener("error",G,!1),r.addEventListener("load",T,!1),r.src=c+l},T=function(e){window.clearTimeout(s),e||!r.error&&r.readyState?m(r):G()},j=function(){v("blob",(function(){E()&&((r=new Image).addEventListener("error",G,!1),r.addEventListener("load",P,!1),r.src=window.URL.createObjectURL(r.response))}))},P=function(){window.URL.revokeObjectURL(r.src),m(r)},k=function(){h?R():D("audio")},C=function(){p?v("blob"):D("video")},R=function(){v("arraybuffer",(function(){E()&&h.decodeAudioData(r.response,(function(e){r=null,m(e)}),(function(e){G(e)}))}))},D=function(e){r=document.createElement(e),f||(window.clearTimeout(s),s=window.setTimeout(T,2e3),r.addEventListener("canplaythrough",T,!1)),r.addEventListener("error",G,!1),r.preload="auto",r.src=c+l,r.load(),f&&m(r)},G=function(e){window.clearTimeout(s);var o=e;if(r&&r.tagName&&r.error){o="MediaError: "+["","ABORTED","NETWORK","DECODE","SRC_NOT_SUPPORTED"][r.error.code]+" "+r.src}else r&&r.statusText?o=r.statusText:e&&e.message?o=e.message:e&&e.type&&(o=e.type);t.emit("error",'Error loading "'+c+l+'" '+o),F()},M=function(){t.off("error"),t.off("progress"),t.off("complete"),r&&(r.removeEventListener("progress",L),r.removeEventListener("load",o),r.removeEventListener("error",G),r.removeEventListener("load",T),r.removeEventListener("canplaythrough",T),r.removeEventListener("load",P))},F=function(){M(),r&&r.abort&&r.readyState<4&&r.abort(),r=null,h=null,i=null,window.clearTimeout(s),t.emit("destroy",a)};return t=Object.create(b.prototype,{_events:{value:{}},id:{value:e.id},start:{value:function(){switch(n=Date.now(),u){case"json":_();break;case"jpg":case"png":case"gif":case"webp":case"svg":A();break;case"mp3":case"ogg":case"opus":case"wav":case"m4a":k();break;case"ogv":case"mp4":case"webm":case"hls":C();break;case"bin":case"binary":v("arraybuffer");break;case"txt":case"text":v("text");break;default:throw"AssetsLoader ERROR: Unknown type for file with URL: "+c+l+" ("+u+")"}}},loaded:{get:function(){return!!i}},file:{get:function(){return i}},destroy:{value:F}})},E=0,_=function e(t){var o,r={},n=[],s=[],i=0,a=0,c={},l=function(r){return Array.isArray(r)?(r.forEach(l),o):((n=!!r.assets&&Array.isArray(r.assets)?e(d(r,t)):x(d(r,t))).once("destroy",g),s.push(n),c[n.id]=n,o);var n},u=function(e){return arguments.length?r[e]?r[e]:c[e]:n},d=function(e,t){"string"==typeof e&&(e={url:e});return void 0===e.isTouchLocked&&(e.isTouchLocked=t.isTouchLocked),void 0===e.blob&&(e.blob=t.blob),void 0===e.basePath&&(e.basePath=t.basePath),e.id=e.id||e.url||String(++E),e.type=e.type||function(e){return e&&e.split("?")[0].split(".").pop().toLowerCase()}(e.url),e.crossOrigin=e.crossOrigin||t.crossOrigin,e.webAudioContext=e.webAudioContext||t.webAudioContext,e.log=t.log,e},f=function(e){var t=i+e;o.emit("progress",t/a)},p=function(e,t,s){Array.isArray(e)&&(e={id:t,file:e,type:s}),i++,o.emit("progress",i/a),r[e.id]=e.file,n.push(e),o.emit("childcomplete",e),m()},h=function(e){a--,o.listeners("error").length?o.emit("error",e):console.error(e),m()},g=function(e){c[e]=null,delete c[e],r[e]=null,delete r[e],n.some((function(t,o){if(t.id===e)return n.splice(o,1),!0}))},m=function(){i>=a&&o.emit("complete",n,r,t.id,"group")};return o=Object.create(L.prototype,{_events:{value:{}},id:{get:function(){return t.id}},add:{value:l},start:{value:function(){return a=s.length,s.forEach((function(e){e.on("progress",f).once("complete",p).once("error",h).start()})),s=[],o}},get:{value:u},find:{value:function(e){if(u(e))return u(e);var t=null;return Object.keys(c).some((function(o){return!!(t=c[o].find&&c[o].find(e))})),t}},getLoader:{value:function(e){return c[e]}},loaded:{get:function(){return i>=a}},file:{get:function(){return n}},destroy:{value:function(){for(;s.length;)s.pop().destroy();return o.off("error"),o.off("progress"),o.off("complete"),n=[],r={},t.webAudioContext=null,a=0,i=0,Object.keys(c).forEach((function(e){c[e].destroy()})),c={},o.emit("destroy",o.id),o}}}),t=d(t||{},{basePath:"",blob:!1,touchLocked:!1,crossOrigin:null,webAudioContext:null,log:!1}),Array.isArray(t.assets)&&l(t.assets),o};_.stats=v;var A=_;const O=e=>{console.error(e)},T=Math.PI/180;let j=window,P=60,k=performance.now(),C=0,R=0,D=k;const G=[],M=[],F=[],S=[];let q=[],U=[],I=-1,B=0;function N(){!function(){let e,t=0,o=1e3/P,r=0;for(t=0;t<G.length;t++)e=G[t],null!=e&&e.func(e.args);for(;q.length>0;)e=q.pop(),e.func(e.args);let n=performance.now();for(R=(n-k)/1e3,C=n-D,t=0;t<M.length;t++)e=M[t],n-e.time>e.delay&&(e.func(e.args),M.splice(t,1));for(n=performance.now();F.length>0;){if(e=F.shift(),r=performance.now(),!(r-n<o)){F.unshift(e);break}e.func(e.args)}for(n=performance.now();S.length>0;)e=S.shift(),r=performance.now(),r-n<o&&e.func(e.args);D=n,q=q.concat(U),U=[]}(),I=j.requestAnimationFrame(N)}N();var W=function(e,t){const o=++B;return G[o]={func:e,args:t},o},z=function(e){return void 0!==G[e]&&(G[e]=null),-1};class H extends n.default{constructor(){var e;super(),console.log(((e,t)=>void 0===e?fxrand():void 0===t?fxrand()*e:e+(t-e)*fxrand())()),console.log(s.default),this.canvas=document.createElement("canvas"),t.GL.init(this.canvas,{alpha:!0,preserveDrawingBuffer:!0}),this._isPlaying=!1,this._efIndex=W((()=>this._loop())),new Promise(((t,o)=>{const r=document.body.querySelector(".Loading-Bar");console.log("Load Assets",u),u.length>0?(document.body.classList.add("isLoading"),new A({assets:u}).on("error",(e=>{console.log("Error :",e)})).on("progress",(e=>{r&&(r.style.width=100*e+"%")})).on("complete",(o=>{r&&(r.style.width="100%"),f(o),setTimeout((()=>{document.body.classList.remove("isLoading"),t(e)}),500)})).start()):t(e)})).then((()=>this._onAssetsLoaded()),O)}_onAssetsLoaded(){console.log("Assets loaded"),this._initWorld()}_initWorld(){this._camera=new t.CameraPerspective,this._camera.setPerspective(70*T,t.GL.aspectRatio,.1,50),this._orbitalControl=new t.OrbitalControl(this._camera,window,5),this._orbitalControl.rx.value=this._orbitalControl.ry.value=.3,this._dAxis=new t.DrawAxis,this._dDots=new t.DrawDotsPlane,this._isPlaying=!0}play(){this._isPlaying=!0}pause(){this._isPlaying=!1}_loop(){this._isPlaying&&(this._update(),this._render())}_update(){}_render(){t.GL.viewport(0,0,t.GL.width,t.GL.height),t.GL.clear(0,0,0,1),t.GL.setMatrices(this._camera),this._dAxis.draw(),this._dDots.draw()}resize(e,o){t.GL.setSize(e,o),this._camera&&this._camera.setPerspective(70*T,t.GL.aspectRatio,.1,50)}destroy(){z(this._efIndex)}}return H}));
